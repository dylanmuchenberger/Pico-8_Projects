pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- menu
function _init() menu_init() end

function menu_init()
 _update=menu_update
 _draw=menu_draw
end

function menu_update()
 if btn(4) or btn(5)then
  game_init()
 end
end

function menu_draw()
 cls(5)
 map(0,16,0,0,16,16)
 print('press 🅾️ or ❎ to start',20,64,0)
end
-->8
-- win
function win_init()
 _update=win_update
 _draw=win_draw
end

function win_update()
end

function win_draw()
end
-->8
-- game
function game_init()
  _update=game_update
  _draw=game_draw
  mBtn={x=2,y=2,w=52,h=52}
  upgrades={}
  p=make_player(64,64,1)
end

function clickMoney(px, py)
  if p.x>mBtn.x and p.x<mBtn.x+mBtn.w
  and p.y>mBtn.y and p.y<mBtn.y+mBtn.h then
    p.s=2
    -- btnp for now figure something out later
    if btnp(5) or btnp(4) then
      p.s=3
      -- split earnings already into n,k,m and then add 
      money.addmoney(money, 1)
    end
  else
    p.s=1
  end
end

function game_update()
  -- basic movement
  if btn(0) and p.x>0 then p.x-=2 end
  if btn(1) and p.x<120 then p.x+=2 end
  if btn(2) and p.y>0 then p.y-=2 end
  if btn(3) and p.y<120 then p.y+=2 end

  clickMoney(p.x, p.y)
end

function game_draw()
  cls(13)
  map(0,0,0,0,32,32)
  spr(p.s,p.x,p.y)
  print('p: '..money.m..'m'..money.k..'k'..money.n,70,10,black)
  print(p.x..'/'..p.y,10,10)
end
-->8
-- objects
-- player
function make_player(x,y,sp)
 player={}
 player.x=x
 player.y=y
 player.s=sp
 return player
end

-- money
money={
  n=0,
  k=0,
  m=0,
  addmoney=function(self, amount)
    -- Works for now but can be broken.
    if amount<=1000 then
      self.n+=amount
      if self.n>=1000 then
        k=flr(self.n/1000)
        self.k+=k
        self.n-=k*1000
      end
    elseif amount>1000 then
      k=flr(amount/1000)
      self.k+=k
      rest=amount-k*1000
      self.addmoney(self, rest)
    end
  end
}

-- upgrades
function make_upgrade(x,y,w,h,s,cost,earn,inc)
 local u={}
 u.x=x
 u.y=y
 u.w=w
 u.h=h
 u.s=s
 u.cost=cost -- price
 u.earn=earn -- money per cycle
 u.inc=inc -- cost increase e.g. cost*1.95
 add(upgrades,u)
end

-- stats
-->8
-- extra functions
__gfx__
0000000000099000000880000008800000000000000000000000000000000000000000000000000000000000000000007f7f7f7f7f7f7f33337f7f7f7f7f7f7f
000000000009900000099000000880000000000000000000000000000000000000000000000000000000000000000000f7f7f7f7f7faaabbbb3337f7f7f7f7f7
0070070000099000000990000008800000000000000000000000000000000000000000000000000000000000000000007f7f7f7faaabbbbbbbbbb3337f7f7f7f
000770009990099989900998888008880000000000000000000000000000000000000000000000000000000000000000f7f7f7aabbbbbbbbbbbbbbbb33f7f7f7
0007700099900999899009988880088800000000000000000000000000000000000000000000000000000000000000007f7f7abbbbbbbbbbbbbbbbbbbb3f7f7f
007007000009900000099000000880000000000000000000000000000000000000000000000000000000000000000000f7f7abbbbbbbbbbbbbbbbbbbbbb3f7f7
0000000000099000000990000008800000000000000000000000000000000000000000000000000000000000000000007f7abbbbbbbbb333333bbbbbbbbb3f7f
000000000009900000088000000880000000000000000000000000000000000000000000000000000000000000000000f7fabbbbbbbbb333333bbbbbbbbb37f7
7f7f7f7f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000007fabbbbbbbbbb33bbbb33bbbbbbbb37f
f7f7f7f70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f7abbbbbbbbbb33bbbb33bbbbbbbb3f7
7f7f7f7f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000007fabbbbbbbbbb33bbbbbb33bbbbbb37f
f7f7f7f70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fabbbbbbbbbbb33bbbbbb33bbbbbbb37
7f7f7f7f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000007abbbbbbbbbbb33bbbbbb33bbbbbbb3f
f7f7f7f70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fabbbbbbbbbbb33bbbbbb33bbbbbbb37
7f7f7f7f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000abbbbbbbbbbbb33bbbb33bbbbbbbbbb3
f7f7f7f70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000abbbbbbbbbbbb33bbbb33bbbbbbbbbb3
0000000000000000000000007f7f7f7f0000000000000000000000000000000000000000000000000000000000000000abbbbbbbbbbbb333333bbbbbbbbbbbb3
000000011000000011111111f7f7f7f70000000000000000000000000000000000000000000000000000000000000000abbbbbbbbbbbb333333bbbbbbbbbbbb3
0000011cc1100000cccccccc7f7f7f7f00000000000000000000000000000000000000000000000000000000000000007abbbbbbbbbbb33bbbbbbbbbbbbbbb3f
00001cccccc10000ccccccccf7f7f7f70000000000000000000000000000000000000000000000000000000000000000fabbbbbbbbbbb33bbbbbbbbbbbbbbb37
0001cc7f7fcc10007f7f7f7fcccccccc00000000000000000000000000000000000000000000000000000000000000007abbbbbbbbbbb33bbbbbbbbbbbbbbb3f
001cc7f7f7fcc100f7f7f7f7cccccccc0000000000000000000000000000000000000000000000000000000000000000f7abbbbbbbbbb33bbbbbbbbbbbbbb3f7
001c7f7f7f7fc1007f7f7f7f1111111100000000000000000000000000000000000000000000000000000000000000007fabbbbbbbbbb33bbbbbbbbbbbbbb37f
01ccf7f7f7f7cc10f7f7f7f7000000000000000000000000000000000000000000000000000000000000000000000000f7abbbbbbbbbb33bbbbbbbbbbbbbb3f7
01cc7f7f7f7fcc1001cc7f7f7f7fcc1000000000000000000000000000000000000000000000000000000000000000007f7abbbbbbbbbbbbbbbbbbbbbbbb3f7f
001cf7f7f7f7c10001ccf7f7f7f7cc100000000000000000000000000000000000000000000000000000000000000000f7fabbbbbbbbbbbbbbbbbbbbbbbb37f7
001ccf7f7f7cc10001cc7f7f7f7fcc1000000000000000000000000000000000000000000000000000000000000000007f7fabbbbbbbbbbbbbbbbbbbbbb37f7f
0001ccf7f7cc100001ccf7f7f7f7cc100000000000000000000000000000000000000000000000000000000000000000f7f7fabbbbbbbbbbbbbbbbbbbb37f7f7
00001cccccc1000001cc7f7f7f7fcc1000000000000000000000000000000000000000000000000000000000000000007f7f7faabbbbbbbbbbbbbbbb337f7f7f
0000011cc110000001ccf7f7f7f7cc100000000000000000000000000000000000000000000000000000000000000000f7f7f7f7aaabbbbbbbbbb333f7f7f7f7
000000011000000001cc7f7f7f7fcc1000000000000000000000000000000000000000000000000000000000000000007f7f7f7f7f7aaabbbb333f7f7f7f7f7f
000000000000000001ccf7f7f7f7cc100000000000000000000000000000000000000000000000000000000000000000f7f7f7f7f7f7f7aaaaf7f7f7f7f7f7f7
__map__
2022222222222221202222222222222100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101033321010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32100c0d0e0f1033302323232323233100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32101c1d1e1f1033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32102c2d2e2f1033202222222222222100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32103c3d3e3f1033321010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101033302323232323233100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3023232323232331202222222222222100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2022222222222221321010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101033302323232323233100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101033202222222222222100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101033321010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101033302323232323233100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101033202222222222222100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101033321010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3023232323232331302323232323233100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2022222222222222222222222222222100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3210101010101010101010101010103300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3023232323232323232323232323233100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
