pico-8 cartridge // http://www.pico-8.com
version 27
__lua__

function set_player(x,y,w,h)
  local p={
    x=x,
    y=y-2,
    w=w,
    h=h,
    cs=1,
    s=1,
    dx=0,
    dy=0,
    ds=2,
    j=0,
    og=true,
    jump_max=-3.5,
    jump=1,
  }

  return p
end

function _init()
  p=set_player(10,100,7,7)
  grav=1
  init_items()
end


function move_player()
  if btn(1) then
    p.dx=p.ds
    p.cs=1
  elseif btn(0) then
    p.dx=-p.ds
    p.cs=2
  else
    p.dx=0
  end

  if map_collision(p.x+p.dx,p.y,p.w,p.h) then
    p.dx=0
  end

  if btnp(5) and p.og then
    if p.jump == 0 then
      p.x=10
      p.y=100
      p.jump=2
    end
    p.j=p.jump_max
    p.og=false
    p.jump-=1
  end
  p.dy+=grav+p.j
  
  if map_collision(p.x,p.y+p.dy,p.w,p.h) then
    p.s=p.cs
    if map_collision(p.x,p.y+1,p.w,p.h) then
      p.dy=0
      p.og=true
    else
      p.dy=1
    end
  else
    p.s=3+(p.cs-1)
  end

  if p.j<0 then
    p.j+=1
  elseif p.j>=0 then
    p.j=0
  end

  p.y+=p.dy
  p.x+=p.dx
end

function map_collision(x,y,w,h)
  collide=false
  for i=x,x+w,w do
    if fget(mget(i/8,y/8))==2 or fget(mget(i/8,(y+h)/8))==2 then
      collide=true
    end
  end

  return collide
end

function _update()
  move_player()
  update_items()
end

function _draw()
  cls()
  map(0,0,0,0,16,16)
  draw_items()
  spr(p.s,p.x,p.y)
  print(p.jump,5,5,7)
end

-->8
-- Coins
function init_items()
  coins = {}
  add(coins, {s=5, x=6, y=12})
  add(coins, {s=5, x=10, y=11 })
  add(coins, {s=5, x=13, y=10})
  add(coins, {s=5, x=14, y=8})
  add(coins, {s=5, x=11, y=7})
  add(coins, {s=5, x=8, y=6})
  add(coins, {s=5, x=5, y=5})
  add(coins, {s=5, x=2, y=4})
end

function update_items()
  colltest=false

  for c in all(coins) do
    if aabb(p.x, p.y, p.w, p.h, c.x*8, c.y*8,8,8) then
      colltest=true
      p.jump+=1
      del(coins, c)
    end
  end
end

function draw_items()
  for c in all(coins) do
    spr(c.s, c.x*8, c.y*8)
  end
  print(colltest, 64, 64, 8)
end

function aabb(x1,y1,w1,h1,x2,y2,w2,h2)
  if x1 < x2 + w2 and x1 + w1 > x2 and y1 < y2 + h2 and y1 + h1 > y2 then
    return true
  end
  return false
end

__gfx__
0000000000000000000000000000000000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000333b0000333b0000dccd0000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000003b0000003b000003737b003737b000dccccd000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000333b0000333b00033333b0033333b0dcdccdcd00000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000003737b003737b00033333b0033333b00ddccdd000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700033333b0033333b00033bb000033bb0000dccd0000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000033333b0033333b00003b0000003b00000dccd0000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000033333bbb333333bb0000000000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00500400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05845840000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55554444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55588444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555005550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6ccccccd550550550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6ccccccd505555050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6ccccccd055005500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6ccccccd055005500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6ccccccd505555050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6ccccccd550550550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd555005550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000040000000000000000000000000000000000000000000000000000000000000000020200000000000000000000000000020202000000000000000002000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4040404040404040404040404040404040404040404040404040404040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041404141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141404141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141404141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141404141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141404040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414140404040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414040414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141404041414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040404040404040404040404040404040404040404040404040404040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040404040404040404040404040404040404040404040404040404040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414040414141414141414141414141414140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040404040404040404040404040404040404040404040404040404040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
